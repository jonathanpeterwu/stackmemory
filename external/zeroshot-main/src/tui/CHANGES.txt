TUI Performance & UX Improvements
==================================

## New Features

### 4. Two-Level Navigation ðŸŽ¯
**Feature:** Completely separate layouts for overview vs detail
**Implementation:**
- Overview mode: ONLY shows clusters table + stats (agents/logs hidden)
- Detail mode: ONLY shows agents + logs (clusters/stats hidden)
- Enter key to drill into detail, Escape to return
- Help text updates dynamically based on current view
- Widgets physically shown/hidden (not just empty data)

## Fixed Issues

### 1. Slow Startup âš¡
**Problem:** TUI took 5-10 seconds to start due to synchronous cluster loading
**Solution:**
- Deferred initial polls by 50-100ms to let UI render first
- Shows "Loading..." message immediately
- Lazy-loads cluster ledgers only when needed
- Startup now instant (<100ms)

### 2. Default Filter ðŸŽ¯
**Problem:** Showed all clusters (including stopped) by default
**Solution:**
- Changed default filter from "all" to "running"
- User only sees active clusters
- Can still use `--filter all` to see everything

### 3. Cluster Selection ðŸ“
**Problem:** Agents and logs weren't properly filtered by selected cluster
**Solution:**
- Renderer now tracks selectedClusterId
- Agents shown are for the selected cluster only
- Logs filtered to show only messages from selected cluster
- Messages cleared when switching between clusters
- Navigate with â†‘â†“ or jk keys

## Performance Improvements

**Before:**
- Startup: 5-10 seconds
- All clusters loaded synchronously
- All ledgers opened on startup
- Unfiltered logs from all clusters

**After:**
- Startup: <100ms instant
- Clusters loaded async after UI renders
- Ledgers lazy-loaded when needed
- Logs filtered to selected cluster only

## Usage

```bash
# Shows only running clusters (default)
vibe watch

# Show all clusters (including stopped)
vibe watch --filter all

# Show only stopped clusters
vibe watch --filter stopped
```

## Keyboard Navigation

### Two-Level Navigation
- **Overview Mode** (default): ONLY clusters + stats visible
  - Large clusters table (16 rows) with system stats sidebar
  - No agents or logs shown
  - `â†‘` / `k` - Select previous cluster
  - `â†“` / `j` - Select next cluster
  - `Enter` - Switch to detail view for selected cluster

- **Detail Mode**: ONLY agents + logs visible
  - Full-width agents table (9 rows)
  - Full-width live logs (9 rows)
  - Clusters table and stats hidden
  - `Escape` - Switch back to overview mode

Agents and logs auto-update in real-time when in detail view

## Technical Changes

### data-poller.js
- Line 45-53: Deferred initial polls with setTimeout
- Line 196-208: Added lazy loading for cluster ledgers
- Line 201-203: Check if ledger DB exists before loading

### index.js (TUI)
- Line 21: Changed default filter to 'running'
- Line 34-36: Added viewMode state ('overview' or 'detail') and detailClusterId
- Line 48-49: Show "Loading..." message on startup
- Line 107-119: Conditional rendering - agents only shown in detail view
- Line 130-137: Conditional rendering for resource_stats case

### keybindings.js
- Line 14-37: Enter key handler to switch to detail view
- Line 39-59: Escape key handler to switch to overview view
- Line 22, 45: Clear messages when switching views
- Line 29-34: Detail mode - hide clusters/stats, show agents/logs
- Line 52-57: Overview mode - show clusters/stats, hide agents/logs
- Line 24-27, 47-50: Update help text based on view mode

### layout.js
- Line 36: Expanded clusters table to 16 rows (from 6)
- Line 66: Expanded stats box to 16 rows (from 6)
- Line 85: Repositioned agent table to row 0, 9 rows, full width
- Line 119: Repositioned logs to row 9, 9 rows, full width
- Line 165-167: Initially hide agent table and logs (overview mode default)

### cli/index.js
- Line 1161: Changed default filter to 'running' in CLI option

## Testing

Run integration tests:
```bash
node tests/tui-integration.test.js    # Basic TUI startup and data loading
node tests/tui-navigation-test.js     # Two-level navigation functionality
```

Expected: All tests pass, TUI starts instantly

## Notes

- Messages are cluster-scoped (only show for selected cluster)
- Selection persists across refreshes
- Empty clusters (no agents) still show in list
- Logs clear when switching clusters to avoid confusion
