#!/bin/bash
# ChromaDB Hook Wrapper - Routes Claude events to ChromaDB

HOOK_TYPE="$1"
HOOK_DATA="$2"
PROJECT_DIR="$(pwd)"

# Find StackMemory installation
if [ -d "$PROJECT_DIR/scripts" ] && [ -f "$PROJECT_DIR/scripts/claude-chromadb-hook.js" ]; then
    HOOK_SCRIPT="$PROJECT_DIR/scripts/claude-chromadb-hook.js"
elif [ -f "$HOME/.stackmemory/bin/chromadb-hook.js" ]; then
    HOOK_SCRIPT="$HOME/.stackmemory/bin/chromadb-hook.js"
else
    # Skip if ChromaDB hook not found
    exit 0
fi

# Execute ChromaDB hook in background to not block Claude
nohup node "$HOOK_SCRIPT" "$HOOK_TYPE" "$HOOK_DATA" >> "$HOME/.stackmemory/logs/chromadb-hook.log" 2>&1 &

exit 0